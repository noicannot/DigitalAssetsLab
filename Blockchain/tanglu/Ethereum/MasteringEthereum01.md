# 《精通以太坊》
## 什么是以太坊
以太网是“世界的计算机”，这是以太坊平台的一种常见描述。
从计算机科学的角度来说，以太坊是一种确定性但实际上无界的状态机。
它有两个基本功能，第一个是全局可访问的单例状态，第二个是对状态进行更改的虚拟机。
从更实际的角度来说，以太坊是一个开源的，全球的去中心化计算架构，执行成为智能合约的程序。它使用区块链来从同步和存储系统状态，以及称为ether的加密货币来计量和约束执行资源成本。
以太坊平台使开发人员能够利用内置的经济学方法构建强大的去中心化应用程序。在保证持续正常运行时间的同时，还可以减少或消除审查机构，第三方接口和对手风险。
#### 与比特币的比较
以太坊与其他开放区块链共享许多通用元素：连接参与者的对等网络，用于状态同步（工作证明)的共识算法，数字货币（以太）和全局账本（区块链）。
###### 区块链的组件
开源、公开的区块链通常包括以下组件：
* 一个连接参与者，并传播交易和包含已验证交易的区块的点对点网络，基于标准的“gossip”协议。
* 状态机中实现的一系列共识规则。
* 消息，以交易的形式表示，代表状态转移。
* 根据共识规则处理交易的状态机。
* 分布式数据库，区块链，记录所有状态转移的日志。
* 共识算法（例如，Proof-of-Work），通过强制参与者竞争并使用共识规则约束他们，来分散区块链的控制权。
* 上述内容的一个或多个开源软件实现。
所有或大部分这些组件通常组合在一个软件客户端中。
需要限定词来帮助我们理解这些区块链的特性，例如_开源，公开，全球，分散，中立和抗审查等，以确定这些组件给予“区块链”系统的重要涌现特性。
并不是所有的区块链都是相同的。首先询问上面组件的描述，然后询问这个“区块链”是否显示了开源、公开等特性。
#### 以太坊的开发
以太坊的目标和构建在很多方面都和之前的开源区块链有所不同，包括比特币。
以太坊的目的主要不是数字货币支付网络。但数字货币_ether_对于以太坊的运作来说既是不可或缺的也是必要的，以太也被视为一种_实用货币_来支付以太坊平台的使用。
与具有非常有限的脚本语言的比特币不同，以太坊被设计成一个通用可编程区块链，运行一个虚拟机，能够执行任意和无限复杂的代码。比特币的脚本语言故意被限制为简单的真/假消费条件判断，以太坊的语言是_图灵完备的_，这意味着它相当于一台通用计算机，可以运行理论图灵机可以运行的任何计算。
#### 以太坊的诞生
当人们认识到比特币模型的力量，并试图超越加密货币应用，转向其他项目时，人们构思出了以太坊。对于需要更多自由度和更大灵活性的项目，启动新的区块链是唯一的选择。但开始一个新的区块链意味着要构建所有的基础设施元素，测试等。
#### 以太坊开发的四个阶段
以太坊的诞生是第一阶段的启动，名为“前沿（Frontier）”。以太坊的发展计划分四个阶段进行，每个新阶段都会发生重大变化。每个阶段都可能包含子版本，称为“硬分叉”，它们以不向后兼容的方式改变功能。
四个主要的发展阶段代号为前沿（Frontier），家园（Homestead），大都会（Metropolis）和宁静（Serenity）。中间的硬分叉代号为“冰河时代 （Ice Age）”，“DAO”，“蜜桔前哨（Tangerine Whistle）”，“假龙（Spurious Dragon）”，“拜占庭（Byzantium）”和“君士坦丁堡（Constantinople）”。它们在下面列出，以及硬分叉发生的块号：
**之前的过渡**
**Block #0**
**“Frontier”**-以太坊的初始阶段，从2015年7月30日持续到2016年3月。
**Block #200,000**
“Ice Age”-引入指数级难度增长的一个难题，激励了到权益证明的过渡。
**Block #1,150,000**
**Homestead**-以太坊的第二阶段，2016年3月启动。
**Block #1,192,000**
“DAO”-恢复被破坏的DAO合约的硬分叉，导致以太坊和以太坊经典分成两个竞争系统。
**Block #2,463,000**
“Tangerine Whistle”-改变某些IO密集操作的燃气计算方法和清除拒绝服务攻击（利用这些操作的低燃气成本）累积状态的硬分叉。
**Block #2,675,000**
"Spurious Dragon"-解决更多拒绝服务攻击向量和另一种状态清除的硬分叉，还包括传播攻击保护机制。
**当前状态**
位于Metropolis阶段，该阶段计划为两个次级版本的硬分叉，代号Byzantium我Constantinople。拜占庭于2017年10月生效，君士坦丁堡预计将在2018年中期。
**Block #4,370,000**
**“大都会拜占庭”**-大都会是以太坊的第三阶段。拜占庭是Metropolis的两个硬分叉中的第一个。
**未来的计划**
在大都会拜占庭硬分叉之后，大都会还有一个硬分叉计划。大都会之后是以太坊部署的最后阶段，代号为Serenity。
**Constantinople**
大都会阶段的第二部分，计划在2018年中期。预计将包括切换到混合的工作证明/权益证明共识算法，以及其他变更。
**Serenity**
以太坊的第四个也是最后一个阶段。
#### 以太坊：通用的区块链
原始区块链（比特币的区块链）追踪比特币单位的状态及其所有权。
以太坊也是一个分布式状态机。但是，不仅仅追踪货币所有权的状态，以太坊追踪通用数据存储的状态转换。通常我们指的是任何可以表示为键值对key-value tuple_的数据，键值数据存储简单地存储任何通过某个键引用的值。
例如，存储由“Book Title”键引用的值“Mastering Ethereum”。在某些方面，这与通用计算机使用的_Random访问存储器（RAM）的数据存储模型具有相同的用途。以太坊有memory存储代码和数据，它使用以太坊区块链来跟踪这些内存随着时间的变化。就像通用的存储程序的计算机一样，以太坊可以将代码加载到其状态机中并运行该代码，将结果状态更改存储在其区块链中。与通用计算机的两个重要差异在于，以太坊状态的变化受共识规则的支配，并且状态通过共享账本全球分布。
#### 以太坊的组件
在Ethereum中，区块链的组件中描述的区块链系统组件包括：
**P2P Network**
以太坊在以太坊主网上运行，可以通过TCP端口30303访问，运行称作DEVp2p的协议。
**Consensus rules**
以太坊的共识规则。
**Transactions**
Ethereum交易是网络消息，包括发送者，接收者，值和数据负载等。
**State Machine**
以太坊的状态转移由Ethereum虚拟机（EVM）处理，这是一个执行bytecode（机器语言指令）的基于栈的虚拟机。称为“智能合约”的EVM程序以高级语言（如Solidity）编写，并编译为字节码以便在EVM上执行。
**Blockchain**
以太坊的区块链作为database（通常是Google的LeveIDB）存储在每个节点上，该区块链在称作梅克尔帕特里夏树Merkle Patricia Tree的序列化哈希数据结构中包含交易和系统状态。
**Consensus Algorithm**
以太坊目前使用名为_Ethash_的工作量证明算法，但有计划在不久的将来将过渡到称为_Casper_的权益证明（Proof-of-Stake）系统。
**Clients**
以太坊有几个可互操作的客户端软件实现，其中最突出的是Go-Ethereum（Geth）_和_parity。
#### 以太坊和图灵完整性
术语“图灵完全”是英国数学家阿兰图灵的名字命名的，他被认为是计算机科学之父。他证明了存在一些不可计算的问题。具体来说，他证明停机问题Halting Problem（试图评估程序是否最终会停止运行）是不可解决的。
如果它可以用来模拟任何图灵机，这样的系统被称为通用图灵机Universal Turing Machine(UTM)。
以太坊在一个名为以太坊虚拟机的状态机中执行存储程序，在内存中读写数据的能力，使其成为一个图灵完整系统，因此是一台通用图灵机。对于有限的存储，以太坊可以计算任何图灵机可以计算的算法。
以太坊的创新是将存储程序计算机的通用计算架构与去中心化区块链相结合，从而创建分布式单状态（单例）世界计算机。以太坊程序“到处”运行，但却产生了共识规则所保证的共同（共识）状态。
#### 图灵完备是一个“特性”
即使是最简单的状态机也会出现图灵完备性。
以太坊是图灵完备的事实意味着任何复杂的程序都可以在以太坊中计算。但是这种灵活性带来了一些棘手的安全和资源管理问题。
#### 图灵完备的含义
图灵证明，你无法通过在计算机上模拟程序来预测程序是否会终止。
在世界计算机中，滥用资源的程序会滥用世界资源。如果以太坊无法预测资源使用情况，以太坊如何限制智能合约使用的资源？
以太坊引入了称为燃气_gas_的计量机制。随着EVM执行智能合约，它会仔细考虑每条指令（计算，数据访问等）。每条指令都有一个以燃气为单位的预定成本。当交易触发智能合约的执行时，它必须包含一定量的燃气，用以设定运行智能合约可消耗的计算上限。如果计算所消耗的燃气量超过交易中可用的天然气量，则EVM将终止执行。Gas是以太坊用于允许图灵完备计算的机制，同时限制任何程序可以使用的资源。
#### 从通用区块链到去中心化应用（DApps）
以太坊作为一种可用于各种用途的通用区块链的方式开始。以太坊的愿景扩展为编程去中心化应用（DApps）的平台。DApps代表比“智能合约”更广阔的视角。DApp至少是一个智能合约和一个web用户界面。更广泛地说，DApp是一个基于开放的，去中心化的，点对点基础架构服务的Web应用程序。
DApp至少由以下部分组成：
* 区块链上的智能合约
* 一个Web前端用户界面
另外，许多DApp还包括其他去中心化组件，例如：
* 去中心化（P2P）存储协议和平台。
* 去中心化（P2P）消息传递协议和平台。
DApps拼写为DApps.D字符是拉丁字符，称为“ETH”，暗指以太坊。“ETH”，要显示此字符，在HTML中使用十进制实体Tip #208，并使用Unicode字符0xCE（UTF-8）或0x00D0（UTF-16）。
#### 万维网的进化
2004年,“Web 2.0”一词引入注目，描述了网络向用户生成内容，响应接口和交互性的演变。
DApps的概念旨在将万维网引入下一个自然演进，将去中心化对等协议引入Web应用程序的每个方面。术语为Web3，意思是网络的第三个“版本”。从集中拥有和管理的应用程序到基于去中心化协议的应用程序。
Ethereum+web3js+JavaScript库，它将你的浏览器中运行的JavaScript应用程序与以太坊区块链连接起来。web3.js库还包含一个名为Swarm的P2P存储网络接口和一个称为Whisper的P2P消息传递服务。通过在你的Web浏览器中运行的JavaScript库中包含这三个组件，开发人员可以使用完整的应用程序开发套件来构建web3 DApps：

![e5a18b952ab023b0a72ddfd08f4a38d8.png](en-resource://database/789:1)

#### 以太坊的开发文化
在比特币中，开发以保守原则为指导：所有变化都经过仔细研究，以确保现有系统都不会中断。大部分情况下，只有在向后兼容时才会执行更改。允许现有客户“选择加入”，但如果他们决定不升级，将继续运作。
相比之下，以太坊中，开发文化的重点是速度和创新。“快速行动，解决事情”。以太坊的开发文化的特点是快速创新，快速进化和愿意参与实验。
对开发者来说要保持灵活性，随着一些潜在的假设变化，准备重建你的基础设施。不要以为任何东西都是静态的或永久的。以太坊开发人员重大挑战是将代码部署到不可变账本与仍在快速发展的开发平台之间的内在矛盾。不能简单“升级”智能合约。必须准备部署新的，迁移用户，应用程序和资金，并重新开始。
在以太坊有很少的神圣原则，最终标准或固定接口。
最终以太坊核心协议的开发速度将会放慢，其接口将会变得固定。但与此同时，创新是推动原则。
#### 为什么学习以太坊？
区块链具有非常陡峭的学习曲线，因为它们将多个学科合并到一个领域，编程，信息安全，密码学，经济学，分布式系统，对等网络等。
以太坊是学习区块链的绝佳平台，它构建了一个庞大的开发者社区，比任何其他区块链平台都快。相比其他区块链，以太坊是开发者为开发者开发的开发者的区块链。熟悉JavaScript应用程序的开发人员可以进入以太坊并开始快速生成工作代码。这是一把双刃剑，编写代码很容易，但编写good代码和secure代码非常困难。
